#include <stdint.h>
#include <stdio.h>
#include <omp.h>
#include <immintrin.h>
#include<string.h>
#include<ctype.h>

#define Nb 8

   
unsigned char key[4][8] ;
void set_key(const unsigned char *k32) {
    // k32 is a 32-byte buffer from Python
    memcpy(key, k32, 32);
}


unsigned char sbox0[256] = {
  0x63,0x7C,0x77,0x7B,0xF2,0x6B,0x6F,0xC5,0x30,0x01,0x67,0x2B,0xFE,0xD7,0xAB,0x76,
  0xCA,0x82,0xC9,0x7D,0xFA,0x59,0x47,0xF0,0xAD,0xD4,0xA2,0xAF,0x9C,0xA4,0x72,0xC0,
  0xB7,0xFD,0x93,0x26,0x36,0x3F,0xF7,0xCC,0x34,0xA5,0xE5,0xF1,0x71,0xD8,0x31,0x15,
  0x04,0xC7,0x23,0xC3,0x18,0x96,0x05,0x9A,0x07,0x12,0x80,0xE2,0xEB,0x27,0xB2,0x75,
  0x09,0x83,0x2C,0x1A,0x1B,0x6E,0x5A,0xA0,0x52,0x3B,0xD6,0xB3,0x29,0xE3,0x2F,0x84,
  0x53,0xD1,0x00,0xED,0x20,0xFC,0xB1,0x5B,0x6A,0xCB,0xBE,0x39,0x4A,0x4C,0x58,0xCF,
  0xD0,0xEF,0xAA,0xFB,0x43,0x4D,0x33,0x85,0x45,0xF9,0x02,0x7F,0x50,0x3C,0x9F,0xA8,
  0x51,0xA3,0x40,0x8F,0x92,0x9D,0x38,0xF5,0xBC,0xB6,0xDA,0x21,0x10,0xFF,0xF3,0xD2,
  0xCD,0x0C,0x13,0xEC,0x5F,0x97,0x44,0x17,0xC4,0xA7,0x7E,0x3D,0x64,0x5D,0x19,0x73,
  0x60,0x81,0x4F,0xDC,0x22,0x2A,0x90,0x88,0x46,0xEE,0xB8,0x14,0xDE,0x5E,0x0B,0xDB,
  0xE0,0x32,0x3A,0x0A,0x49,0x06,0x24,0x5C,0xC2,0xD3,0xAC,0x62,0x91,0x95,0xE4,0x79,
  0xE7,0xC8,0x37,0x6D,0x8D,0xD5,0x4E,0xA9,0x6C,0x56,0xF4,0xEA,0x65,0x7A,0xAE,0x08,
  0xBA,0x78,0x25,0x2E,0x1C,0xA6,0xB4,0xC6,0xE8,0xDD,0x74,0x1F,0x4B,0xBD,0x8B,0x8A,
  0x70,0x3E,0xB5,0x66,0x48,0x03,0xF6,0x0E,0x61,0x35,0x57,0xB9,0x86,0xC1,0x1D,0x9E,
  0xE1,0xF8,0x98,0x11,0x69,0xD9,0x8E,0x94,0x9B,0x1E,0x87,0xE9,0xCE,0x55,0x28,0xDF,
  0x8C,0xA1,0x89,0x0D,0xBF,0xE6,0x42,0x68,0x41,0x99,0x2D,0x0F,0xB0,0x54,0xBB,0x16
};

unsigned char invSbox0[256] = {
  0x52,0x09,0x6A,0xD5,0x30,0x36,0xA5,0x38,0xBF,0x40,0xA3,0x9E,0x81,0xF3,0xD7,0xFB,
  0x7C,0xE3,0x39,0x82,0x9B,0x2F,0xFF,0x87,0x34,0x8E,0x43,0x44,0xC4,0xDE,0xE9,0xCB,
  0x54,0x7B,0x94,0x32,0xA6,0xC2,0x23,0x3D,0xEE,0x4C,0x95,0x0B,0x42,0xFA,0xC3,0x4E,
  0x08,0x2E,0xA1,0x66,0x28,0xD9,0x24,0xB2,0x76,0x5B,0xA2,0x49,0x6D,0x8B,0xD1,0x25,
  0x72,0xF8,0xF6,0x64,0x86,0x68,0x98,0x16,0xD4,0xA4,0x5C,0xCC,0x5D,0x65,0xB6,0x92,
  0x6C,0x70,0x48,0x50,0xFD,0xED,0xB9,0xDA,0x5E,0x15,0x46,0x57,0xA7,0x8D,0x9D,0x84,
  0x90,0xD8,0xAB,0x00,0x8C,0xBC,0xD3,0x0A,0xF7,0xE4,0x58,0x05,0xB8,0xB3,0x45,0x06,
  0xD0,0x2C,0x1E,0x8F,0xCA,0x3F,0x0F,0x02,0xC1,0xAF,0xBD,0x03,0x01,0x13,0x8A,0x6B,
  0x3A,0x91,0x11,0x41,0x4F,0x67,0xDC,0xEA,0x97,0xF2,0xCF,0xCE,0xF0,0xB4,0xE6,0x73,
  0x96,0xAC,0x74,0x22,0xE7,0xAD,0x35,0x85,0xE2,0xF9,0x37,0xE8,0x1C,0x75,0xDF,0x6E,
  0x47,0xF1,0x1A,0x71,0x1D,0x29,0xC5,0x89,0x6F,0xB7,0x62,0x0E,0xAA,0x18,0xBE,0x1B,
  0xFC,0x56,0x3E,0x4B,0xC6,0xD2,0x79,0x20,0x9A,0xDB,0xC0,0xFE,0x78,0xCD,0x5A,0xF4,
  0x1F,0xDD,0xA8,0x33,0x88,0x07,0xC7,0x31,0xB1,0x12,0x10,0x59,0x27,0x80,0xEC,0x5F,
  0x60,0x51,0x7F,0xA9,0x19,0xB5,0x4A,0x0D,0x2D,0xE5,0x7A,0x9F,0x93,0xC9,0x9C,0xEF,
  0xA0,0xE0,0x3B,0x4D,0xAE,0x2A,0xF5,0xB0,0xC8,0xEB,0xBB,0x3C,0x83,0x53,0x99,0x61,
  0x17,0x2B,0x04,0x7E,0xBA,0x77,0xD6,0x26,0xE1,0x69,0x14,0x63,0x55,0x21,0x0C,0x7D
};

unsigned char sbox1[256] = {
    0x6C,0x73,0x78,0x74,0xFD,0x64,0x60,0xCA,0x3F,0x0E,0x68,0x24,0xF1,0xD8,0xA4,0x79,
    0xC5,0x8D,0xC6,0x72,0xF5,0x56,0x48,0xFF,0xA2,0xDB,0xAD,0xA0,0x93,0xAB,0x7D,0xCF,
    0xB8,0xF2,0x9C,0x29,0x39,0x30,0xF8,0xC3,0x3B,0xAA,0xEA,0xFE,0x7E,0xD7,0x3E,0x1A,
    0x0B,0xC8,0x2C,0xCC,0x17,0x99,0x0A,0x95,0x08,0x1D,0x8F,0xED,0xE4,0x28,0xBD,0x7A,
    0x06,0x8C,0x23,0x15,0x14,0x61,0x55,0xAF,0x5D,0x34,0xD9,0xBC,0x26,0xEC,0x20,0x8B,
    0x5C,0xDE,0x0F,0xE2,0x2F,0xF3,0xBE,0x54,0x65,0xC4,0xB1,0x36,0x45,0x43,0x57,0xC0,
    0xDF,0xE0,0xA5,0xF4,0x4C,0x42,0x3C,0x8A,0x4A,0xF6,0x0D,0x70,0x5F,0x33,0x90,0xA7,
    0x5E,0xAC,0x4F,0x80,0x9D,0x92,0x37,0xFA,0xB3,0xB9,0xD5,0x2E,0x1F,0xF0,0xFC,0xDD,
    0xC2,0x03,0x1C,0xE3,0x50,0x98,0x4B,0x18,0xCB,0xA8,0x71,0x32,0x6B,0x52,0x16,0x7C,
    0x6F,0x8E,0x40,0xD3,0x2D,0x25,0x9F,0x87,0x49,0xE1,0xB7,0x1B,0xD1,0x51,0x04,0xD4,
    0xEF,0x3D,0x35,0x05,0x46,0x09,0x2B,0x53,0xCD,0xDC,0xA3,0x6D,0x9E,0x9A,0xEB,0x76,
    0xE8,0xC7,0x38,0x62,0x82,0xDA,0x41,0xA6,0x63,0x59,0xFB,0xE5,0x6A,0x75,0xA1,0x07,
    0xB5,0x77,0x2A,0x21,0x13,0xA9,0xBB,0xC9,0xE7,0xD2,0x7B,0x10,0x44,0xB2,0x84,0x85,
    0x7F,0x31,0xBA,0x69,0x47,0x0C,0xF9,0x01,0x6E,0x3A,0x58,0xB6,0x89,0xCE,0x12,0x91,
    0xEE,0xF7,0x97,0x1E,0x66,0xD6,0x81,0x9B,0x94,0x11,0x88,0xE6,0xC1,0x5A,0x27,0xD0,
    0x83,0xAE,0x86,0x02,0xB0,0xE9,0x4D,0x67,0x4E,0x96,0x22,0x00,0xBF,0x5B,0xB4,0x19
};

unsigned char invSbox1[256] = {
    0xFB,0xD7,0xF3,0x81,0x9E,0xA3,0x40,0xBF,0x38,0xA5,0x36,0x30,0xD5,0x6A,0x09,0x52,
    0xCB,0xE9,0xDE,0xC4,0x44,0x43,0x8E,0x34,0x87,0xFF,0x2F,0x9B,0x82,0x39,0xE3,0x7C,
    0x4E,0xC3,0xFA,0x42,0x0B,0x95,0x4C,0xEE,0x3D,0x23,0xC2,0xA6,0x32,0x94,0x7B,0x54,
    0x25,0xD1,0x8B,0x6D,0x49,0xA2,0x5B,0x76,0xB2,0x24,0xD9,0x28,0x66,0xA1,0x2E,0x08,
    0x92,0xB6,0x65,0x5D,0xCC,0x5C,0xA4,0xD4,0x16,0x98,0x68,0x86,0x64,0xF6,0xF8,0x72,
    0x84,0x9D,0x8D,0xA7,0x57,0x46,0x15,0x5E,0xDA,0xB9,0xED,0xFD,0x50,0x48,0x70,0x6C,
    0x06,0x45,0xB3,0xB8,0x05,0x58,0xE4,0xF7,0x0A,0xD3,0xBC,0x8C,0x00,0xAB,0xD8,0x90,
    0x6B,0x8A,0x13,0x01,0x03,0xBD,0xAF,0xC1,0x02,0x0F,0x3F,0xCA,0x8F,0x1E,0x2C,0xD0,
    0x73,0xE6,0xB4,0xF0,0xCE,0xCF,0xF2,0x97,0xEA,0xDC,0x67,0x4F,0x41,0x11,0x91,0x3A,
    0x6E,0xDF,0x75,0x1C,0xE8,0x37,0xF9,0xE2,0x85,0x35,0xAD,0xE7,0x22,0x74,0xAC,0x96,
    0x1B,0xBE,0x18,0xAA,0x0E,0x62,0xB7,0x6F,0x89,0xC5,0x29,0x1D,0x71,0x1A,0xF1,0x47,
    0xF4,0x5A,0xCD,0x78,0xFE,0xC0,0xDB,0x9A,0x20,0x79,0xD2,0xC6,0x4B,0x3E,0x56,0xFC,
    0x5F,0xEC,0x80,0x27,0x59,0x10,0x12,0xB1,0x31,0xC7,0x07,0x88,0x33,0xA8,0xDD,0x1F,
    0xEF,0x9C,0xC9,0x93,0x9F,0x7A,0xE5,0x2D,0x0D,0x4A,0xB5,0x19,0xA9,0x7F,0x51,0x60,
    0x61,0x99,0x53,0x83,0x3C,0xBB,0xEB,0xC8,0xB0,0xF5,0x2A,0xAE,0x4D,0x3B,0xE0,0xA0,
    0x7D,0x0C,0x21,0x55,0x63,0x14,0x69,0xE1,0x26,0xD6,0x77,0xBA,0x7E,0x04,0x2B,0x17
};

unsigned char sbox2[256] = {
    0x02,0x1F,0xA7,0x5D,0x14,0x38,0x00,0xA8,0x7E,0xB8,0xA4,0xBA,0xD0,0x1C,0xDF,0x33,
    0xA6,0xAD,0xD1,0xF9,0xD9,0x77,0x05,0x20,0x85,0x2C,0x13,0xE5,0x7D,0xFE,0x17,0x98,
    0xDA,0x4D,0xCA,0x21,0x95,0x93,0xC5,0x81,0x99,0x64,0x27,0x41,0x12,0x61,0x57,0xDE,
    0x62,0x07,0xE0,0xC6,0x50,0xB6,0x0F,0xD2,0x1E,0x53,0xC8,0x3D,0x6F,0x30,0x31,0x0A,
    0x6A,0x73,0x1A,0x5A,0x49,0x0B,0x9B,0x43,0xD5,0x18,0xE2,0x5E,0xBF,0xDC,0x11,0x7A,
    0x15,0xB3,0x36,0x88,0x1D,0x39,0xF8,0xB1,0xE4,0x55,0x6E,0xC4,0xBC,0x89,0x22,0x68,
    0xFA,0x5B,0x19,0xF6,0x5F,0x6B,0x87,0x91,0xA1,0x4C,0x45,0xB2,0x25,0x9F,0x32,0x58,
    0xD8,0x8D,0xE9,0x5C,0xCD,0x66,0x40,0xB9,0xB7,0xD3,0x4A,0x69,0xAC,0x0E,0x86,0xFF,
    0x56,0x8C,0xD7,0x10,0x7F,0x47,0x94,0x51,0xA5,0xE6,0x9C,0x90,0x8A,0x60,0x2F,0xAF,
    0xF0,0x42,0x7B,0x01,0xD6,0x04,0xAB,0xC7,0x8B,0xEC,0xE8,0x2A,0xCF,0x7C,0xB4,0xA9,
    0xDD,0xC2,0x8E,0x2B,0x08,0x35,0x28,0xAE,0x3C,0x0D,0xD4,0x83,0xC3,0x74,0x96,0x92,
    0xC0,0x2E,0x4F,0x84,0x76,0xED,0x48,0xCC,0xEF,0x9D,0xF2,0x26,0xEE,0xB0,0xB5,0x24,
    0xF4,0x3A,0x70,0x46,0xA0,0xA2,0x0C,0x1B,0x63,0xFB,0xBE,0x4E,0x82,0x09,0x71,0xC9,
    0xF3,0xBB,0x54,0x44,0x3E,0x72,0x8F,0xF1,0x59,0x16,0x80,0x3B,0x6C,0x9E,0x23,0x2D,
    0x37,0x34,0x03,0xA3,0xF7,0x3F,0x65,0xAA,0x06,0x67,0xCE,0x78,0x9A,0x4B,0xF5,0x29,
    0xCB,0xEB,0xC1,0xBD,0x79,0x52,0x75,0xEA,0xDB,0xE1,0xE7,0x6D,0xE3,0x97,0xFD,0xFC
};

unsigned char invsbox2[256] = {
    0x06,0x93,0x00,0xE2,0x95,0x16,0xE8,0x31,0xA4,0xCD,0x3F,0x45,0xC6,0xA9,0x7D,0x36,
    0x83,0x4E,0x2C,0x1A,0x04,0x50,0xD9,0x1E,0x49,0x62,0x42,0xC7,0x0D,0x54,0x38,0x01,
    0x17,0x23,0x5E,0xDE,0xBF,0x6C,0xBB,0x2A,0xA6,0xEF,0x9B,0xA3,0x19,0xDF,0xB1,0x8E,
    0x3D,0x3E,0x6E,0x0F,0xE1,0xA5,0x52,0xE0,0x05,0x55,0xC1,0xDB,0xA8,0x3B,0xD4,0xE5,
    0x76,0x2B,0x91,0x47,0xD3,0x6A,0xC3,0x85,0xB6,0x44,0x7A,0xED,0x69,0x21,0xCB,0xB2,
    0x34,0x87,0xF5,0x39,0xD2,0x59,0x80,0x2E,0x6F,0xD8,0x43,0x61,0x73,0x03,0x4B,0x64,
    0x8D,0x2D,0x30,0xC8,0x29,0xE6,0x75,0xE9,0x5F,0x7B,0x40,0x65,0xDC,0xFB,0x5A,0x3C,
    0xC2,0xCE,0xD5,0x41,0xAD,0xF6,0xB4,0x15,0xEB,0xF4,0x4F,0x92,0x9D,0x1C,0x08,0x84,
    0xDA,0x27,0xCC,0xAB,0xB3,0x18,0x7E,0x66,0x53,0x5D,0x8C,0x98,0x81,0x71,0xA2,0xD6,
    0x8B,0x67,0xAF,0x25,0x86,0x24,0xAE,0xFD,0x1F,0x28,0xEC,0x46,0x8A,0xB9,0xDD,0x6D,
    0xC4,0x68,0xC5,0xE3,0x0A,0x88,0x10,0x02,0x07,0x9F,0xE7,0x96,0x7C,0x11,0xA7,0x8F,
    0xBD,0x57,0x6B,0x51,0x9E,0xBE,0x35,0x78,0x09,0x77,0x0B,0xD1,0x5C,0xF3,0xCA,0x4C,
    0xB0,0xF2,0xA1,0xAC,0x5B,0x26,0x33,0x97,0x3A,0xCF,0x22,0xF0,0xB7,0x74,0xEA,0x9C,
    0x0C,0x12,0x37,0x79,0xAA,0x48,0x94,0x82,0x70,0x14,0x20,0xF8,0x4D,0xA0,0x2F,0x0E,
    0x32,0xF9,0x4A,0xFC,0x58,0x1B,0x89,0xFA,0x9A,0x72,0xF7,0xF1,0x99,0xB5,0xBC,0xB8,
    0x90,0xD7,0xBA,0xD0,0xC0,0xEE,0x63,0xE4,0x56,0x13,0x60,0xC9,0xFF,0xFE,0x1D,0x7F
};

unsigned char sbox3[256] = {
    0xD6,0x90,0xE9,0xFE,0xCC,0xE1,0x3D,0xB7,0x16,0xB6,0x14,0xC2,0x28,0xFB,0x2C,0x05,
    0x2B,0x67,0x9A,0x76,0x2A,0xBE,0x04,0xC3,0xAA,0x44,0x13,0x26,0x49,0x86,0x06,0x99,
    0x9C,0x42,0x50,0xF4,0x91,0xEF,0x98,0x7A,0x33,0x54,0x0B,0x43,0xED,0xCF,0xAC,0x62,
    0xE4,0xB3,0x1C,0xA9,0xC9,0x08,0xE8,0x95,0x80,0xDF,0x94,0xFA,0x75,0x8F,0x3F,0xA6,
    0x47,0x07,0xA7,0xFC,0xF3,0x73,0x17,0xBA,0x83,0x59,0x3C,0x19,0xE6,0x85,0x4F,0xA8,
    0x68,0x6B,0x81,0xB2,0x71,0x64,0xDA,0x8B,0xF8,0xEB,0x0F,0x4B,0x70,0x56,0x9D,0x35,
    0x1E,0x24,0x0E,0x5E,0x63,0x58,0xD1,0xA2,0x25,0x22,0x7C,0x3B,0x01,0x21,0x78,0x87,
    0xD4,0x00,0x46,0x57,0x9F,0xD3,0x27,0x52,0x4C,0x36,0x02,0xE7,0xA0,0xC4,0xC8,0x9E,
    0xEA,0xBF,0x8A,0xD2,0x40,0xC7,0x38,0xB5,0xA3,0xF7,0xF2,0xCE,0xF9,0x61,0x15,0xA1,
    0xE0,0xAE,0x5D,0xA4,0x9B,0x34,0x1A,0x55,0xAD,0x93,0x32,0x30,0xF5,0x8C,0xB1,0xE3,
    0x1D,0xF6,0xE2,0x2E,0x82,0x66,0xCA,0x60,0xC0,0x29,0x23,0xAB,0x0D,0x53,0x4E,0x6F,
    0xD5,0xDB,0x37,0x45,0xDE,0xFD,0x8E,0x2F,0x03,0xFF,0x6A,0x72,0x6D,0x6C,0x5B,0x51,
    0x8D,0x1B,0xAF,0x92,0xBB,0xDD,0xBC,0x7F,0x11,0xD9,0x5C,0x41,0x1F,0x10,0x5A,0xD8,
    0x0A,0xC1,0x31,0x88,0xA5,0xCD,0x7B,0xBD,0x2D,0x74,0xD0,0x12,0xB8,0xE5,0xB4,0xB0,
    0x89,0x69,0x97,0x4A,0x0C,0x96,0x77,0x7E,0x65,0xB9,0xF1,0x09,0xC5,0x6E,0xC6,0x84,
    0x18,0xF0,0x7D,0xEC,0x3A,0xDC,0x4D,0x20,0x79,0xEE,0x5F,0x3E,0xD7,0xCB,0x39,0x48
};

unsigned char invsbox3[256] = {
    0x71,0x6C,0x7A,0xB8,0x16,0x0F,0x1E,0x41,0x35,0xEB,0xD0,0x2A,0xE4,0xAC,0x62,0x5A,
    0xCD,0xC8,0xDB,0x1A,0x0A,0x8E,0x08,0x46,0xF0,0x4B,0x96,0xC1,0x32,0xA0,0x60,0xCC,
    0xF7,0x6D,0x69,0xAA,0x61,0x68,0x1B,0x76,0x0C,0xA9,0x14,0x10,0x0E,0xD8,0xA3,0xB7,
    0x9B,0xD2,0x9A,0x28,0x95,0x5F,0x79,0xB2,0x86,0xFE,0xF4,0x6B,0x4A,0x06,0xFB,0x3E,
    0x84,0xCB,0x21,0x2B,0x19,0xB3,0x72,0x40,0xFF,0x1C,0xE3,0x5B,0x78,0xF6,0xAE,0x4E,
    0x22,0xBF,0x77,0xAD,0x29,0x97,0x5D,0x73,0x65,0x49,0xCE,0xBE,0xCA,0x92,0x63,0xFA,
    0xA7,0x8D,0x2F,0x64,0x55,0xE8,0xA5,0x11,0x50,0xE1,0xBA,0x51,0xBD,0xBC,0xED,0xAF,
    0x5C,0x54,0xBB,0x45,0xD9,0x3C,0x13,0xE6,0x6E,0xF8,0x27,0xD6,0x6A,0xF2,0xE7,0xC7,
    0x38,0x52,0xA4,0x48,0xEF,0x4D,0x1D,0x6F,0xD3,0xE0,0x82,0x57,0x9D,0xC0,0xB6,0x3D,
    0x01,0x24,0xC3,0x99,0x3A,0x37,0xE5,0xE2,0x26,0x1F,0x12,0x94,0x20,0x5E,0x7F,0x74,
    0x7C,0x8F,0x67,0x88,0x93,0xD4,0x3F,0x42,0x4F,0x33,0x18,0xAB,0x2E,0x98,0x91,0xC2,
    0xDF,0x9E,0x53,0x31,0xDE,0x87,0x09,0x07,0xDC,0xE9,0x47,0xC4,0xC6,0xD7,0x15,0x81,
    0xA8,0xD1,0x0B,0x17,0x7D,0xEC,0xEE,0x85,0x7E,0x34,0xA6,0xFD,0x04,0xD5,0x8B,0x2D,
    0xDA,0x66,0x83,0x75,0x70,0xB0,0x00,0xFC,0xCF,0xC9,0x56,0xB1,0xF5,0xC5,0xB4,0x39,
    0x90,0x05,0xA2,0x9F,0x30,0xDD,0x4C,0x7B,0x36,0x02,0x80,0x59,0xF3,0x2C,0xF9,0x25,
    0xF1,0xEA,0x8A,0x44,0x23,0x9C,0xA1,0x89,0x58,0x8C,0x3B,0x0D,0x43,0xB5,0x03,0xB9
};
//ab ham 32 byte ko ek saath xor karenge uske liye cpu atleast avx2 supported hona chaiye that is intel or amd ke 2nd gen processors
unsigned char Logtable[256] = {
 0, 0, 25, 1, 50, 2, 26,198, 75,199, 27,104, 51,238,223, 3,
 100, 4,224, 14, 52,141,129,239, 76,113, 8,200,248,105, 28,193,
 125,194, 29,181,249,185, 39,106, 77,228,166,114,154,201, 9,120,
 101, 47,138, 5, 33, 15,225, 36, 18,240,130, 69, 53,147,218,142,
 150,143,219,189, 54,208,206,148, 19, 92,210,241, 64, 70,131, 56,
 102,221,253, 48,191, 6,139, 98,179, 37,226,152, 34,136,145, 16,
 126,110, 72,195,163,182, 30, 66, 58,107, 40, 84,250,133, 61,186,
 43,121, 10, 21,155,159, 94,202, 78,212,172,229,243,115,167, 87,
 175, 88,168, 80,244,234,214,116, 79,174,233,213,231,230,173,232,
 44,215,117,122,235, 22, 11,245, 89,203, 95,176,156,169, 81,160,
 127, 12,246,111, 23,196, 73,236,216, 67, 31, 45,164,118,123,183,
 204,187, 62, 90,251, 96,177,134, 59, 82,161,108,170, 85, 41,157,
 151,178,135,144, 97,190,220,252,188,149,207,205, 55, 63, 91,209,
 83, 57,132, 60, 65,162,109, 71, 20, 42,158, 93, 86,242,211,171,
 68, 17,146,217, 35, 32, 46,137,180,124,184, 38,119,153,227,165,
 103, 74,237,222,197, 49,254, 24, 13, 99,140,128,192,247,112, 7};

 unsigned char Alogtable[256] = {
 1, 3, 5, 15, 17, 51, 85,255, 26, 46,114,150,161,248, 19, 53,
 95,225, 56, 72,216,115,149,164,247, 2, 6, 10, 30, 34,102,170,
 229, 52, 92,228, 55, 89,235, 38,106,190,217,112,144,171,230, 49,
 83,245, 4, 12, 20, 60, 68,204, 79,209,104,184,211,110,178,205,
 76,212,103,169,224, 59, 77,215, 98,166,241, 8, 24, 40,120,136,
 131,158,185,208,107,189,220,127,129,152,179,206, 73,219,118,154,
 181,196, 87,249, 16, 48, 80,240, 11, 29, 39,105,187,214, 97,163,
 254, 25, 43,125,135,146,173,236, 47,113,147,174,233, 32, 96,160,
 251, 22, 58, 78,210,109,183,194, 93,231, 50, 86,250, 21, 63, 65,
 195, 94,226, 61, 71,201, 64,192, 91,237, 44,116,156,191,218,117,
 159,186,213,100,172,239, 42,126,130,157,188,223,122,142,137,128,
 155,182,193, 88,232, 35,101,175,234, 37,111,177,200, 67,197, 84,
 252, 31, 33, 99,165,244, 7, 9, 27, 45,119,153,176,203, 70,202,
 69,207, 74,222,121,139,134,145,168,227, 62, 66,198, 81,243, 14,
 18, 54, 90,238, 41,123,141,140,143,138,133,148,167,242, 13, 23,
 57, 75,221,124,132,151,162,253, 28, 36,108,180,199, 82,246, 1};
 
 unsigned char *sboxes[4] = { sbox0, sbox1, sbox2, sbox3 };
 unsigned char *invSboxes[4] = { invSbox0, invSbox1, invsbox2, invsbox3 };
unsigned char *S=NULL;
static int shift [4] = {0, 1, 3,4};

uint32_t Rcon[10] = {
    0x01, 0x02, 0x04, 0x08,
    0x10, 0x20, 0x40, 0x80,
    0x1B, 0x36
};

unsigned char  gmul(unsigned char a , unsigned char  b) {

 if(a && b)return Alogtable[(Logtable[a] +Logtable[b])%255];
 else return 0;
 }





void addRoundKey(unsigned char state[4][8], unsigned char roundKey[4][8]) {
    for (int r = 0; r < 4; r++) {
        for (int c = 0; c < 8; c++) {
            state[r][c] ^= roundKey[r][c];
        }
    }
}
void invSubBytes(unsigned char state[4][8]) {
   
    

    for (int r = 0; r < 4; r++) {
        unsigned char *inv = invSboxes[r];  
        for (int j = 0; j < 8; j++) {
            state[r][j] = inv[state[r][j]];  
        }
    }
}





void subBytes(unsigned char state[4][8]) {
  


    for (int r = 0; r < 4; r++) {
        unsigned char *sbox = sboxes[r];  
        for (int j = 0; j < 8; j++) {
            state[r][j] = sbox[state[r][j]];  
        }
    }
}


void shiftRows(unsigned char state[4][8], unsigned char d){
    int i,j;
    unsigned char temp[8];
    if(d==0){
         for (i = 1; i < 4; i++) { 
            for (j = 0; j < 8; j++)
                temp[j] = state[i][(j + shift[i]) % 8];
                       
            for (j = 0; j < 8; j++)
                state[i][j] = temp[j];
            }
    }
    else{
        for (i = 1; i < 4; i++) { 
            for (j = 0; j < 8; j++)
                temp[j] = state[i][(j - shift[i] +8 ) % 8];
                       
            for (j = 0; j < 8; j++)
                state[i][j] = temp[j];
            }
    }
}



void mixColumns(unsigned char state[4][8]) {
    unsigned char b[4][8];
    int i, j;

    for (j = 0; j < 8; j++) {
        for (i = 0; i < 4; i++) {
            b[i][j] =
                gmul(2, state[i][j]) ^
                gmul(3, state[(i + 1) % 4][j]) ^
                state[(i + 2) % 4][j] ^
                state[(i + 3) % 4][j];
        }
    }

    
    for (i = 0; i < 4; i++)
        for (j = 0; j < 8; j++)
            state[i][j] = b[i][j];
}

void invMixColumns(unsigned char  state[4][8]) {
    unsigned char b[4][8];
    int i, j;

    for (j = 0; j < 8; j++)           
        for (i = 0; i < 4; i++) {      
            b[i][j] = gmul(0xe, state[i][j]) ^
                      gmul(0xb, state[(i + 1) % 4][j]) ^
                      gmul(0xd, state[(i + 2) % 4][j]) ^
                      gmul(0x9, state[(i + 3) % 4][j]);
        }

    for (i = 0; i < 4; i++)
        for (j = 0; j < 8; j++)
            state[i][j] = b[i][j];
}


 
int keyExpansion(unsigned char key[4][8], unsigned char W[15][4][8]) {
    int i, j, t;
    int ptr = 1;     
    unsigned char tempKey[4][8];      
    unsigned char temp[4];         

    for (j = 0; j < 8; j++)
        for (i = 0; i < 4; i++)
            tempKey[i][j] = key[i][j];

  
    t = 0;  
    for (j = 0; (j < 8) && (t < 15 * 8); j++, t++)
        for (i = 0; i < 4; i++)
            W[t / 8][i][t % 8] = tempKey[i][j];

   
    while (t < 15 * 8) {
      
        for (i = 0; i < 4; i++){
            S = sboxes[i];
            temp[i] = S[tempKey[(i + 1) % 4][7]];
        }
 
        for (i = 0; i < 4; i++)
            tempKey[i][0] ^= temp[i];

   
        tempKey[0][0] ^= Rcon[ptr++];

     
        for (j = 1; j < 4; j++)
            for (i = 0; i < 4; i++)
                tempKey[i][j] ^= tempKey[i][j - 1];

  
        for (i = 0; i < 4; i++){
            S=sboxes[i];
            tempKey[i][4] ^= S[tempKey[i][3]];

        }
        for (j = 5; j < 8; j++)
            for (i = 0; i < 4; i++)
                tempKey[i][j] ^= tempKey[i][j - 1];

 
        for (j = 0; (j < 8) && (t < 15 * 8); j++, t++)
            for (i = 0; i < 4; i++)
                W[t / 8][i][t % 8] = tempKey[i][j];
    }

    return 0;
}




int encrypt(unsigned char state[4][8], unsigned char roundKeys[15][4][8]) {
    keyExpansion(key, roundKeys);
    int round;

    addRoundKey(state, roundKeys[0]);

    for (round = 1; round <= 13; round++) {
        subBytes(state);
        shiftRows(state,0);
        mixColumns(state);
        addRoundKey(state, roundKeys[round]);
    }

    subBytes(state);
    shiftRows(state,0);
    addRoundKey(state, roundKeys[14]);

    return 0;
}




int decrypt(unsigned char state[4][8], unsigned char roundKeys[15][4][8]) {
    keyExpansion(key, roundKeys);
    int round;

    addRoundKey(state, roundKeys[14]);
    invSubBytes(state);
    shiftRows(state,1);

    for (round = 13; round >= 1; round--) {
        addRoundKey(state, roundKeys[round]);
        invMixColumns(state);
        invSubBytes(state);
        shiftRows(state,1);
        
       

    }
    addRoundKey(state, roundKeys[0]);

    return 0;
}










void cleanBase64Input(char *str) {
    int len = strlen(str);
    int j = 0;
    for (int i = 0; i < len; i++) {
        char c = str[i];
        if (isalnum(c) || c == '+' || c == '/' || c == '=')
            str[j++] = c;
    }
    str[j] = '\0';
    str[strcspn(str, "\r\n ")] = '\0';
    while (strlen(str) % 4 != 0)
        strcat(str, "=");
}




int base64_encode(const unsigned char *input, int length, char *output) {
    static const char table[] =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

    int i, j;
    for (i = 0, j = 0; i < length;) {
        uint32_t octet_a = i < length ? input[i++] : 0;
        uint32_t octet_b = i < length ? input[i++] : 0;
        uint32_t octet_c = i < length ? input[i++] : 0;

        uint32_t triple = (octet_a << 16) | (octet_b << 8) | octet_c;

        output[j++] = table[(triple >> 18) & 0x3F];
        output[j++] = table[(triple >> 12) & 0x3F];
        output[j++] = (i > length + 1) ? '=' : table[(triple >> 6) & 0x3F];
        output[j++] = (i > length) ? '=' : table[triple & 0x3F];
    }

    int mod = length % 3;
    if (mod == 1) output[j - 2] = output[j - 1] = '=';
    else if (mod == 2) output[j - 1] = '=';

    output[j] = '\0';
    return j;
}




int base64_decode(const char *input, unsigned char *output) {
    static const unsigned char dtable[256] = {
        ['A']=0,['B']=1,['C']=2,['D']=3,['E']=4,['F']=5,['G']=6,['H']=7,
        ['I']=8,['J']=9,['K']=10,['L']=11,['M']=12,['N']=13,['O']=14,['P']=15,
        ['Q']=16,['R']=17,['S']=18,['T']=19,['U']=20,['V']=21,['W']=22,['X']=23,
        ['Y']=24,['Z']=25,['a']=26,['b']=27,['c']=28,['d']=29,['e']=30,['f']=31,
        ['g']=32,['h']=33,['i']=34,['j']=35,['k']=36,['l']=37,['m']=38,['n']=39,
        ['o']=40,['p']=41,['q']=42,['r']=43,['s']=44,['t']=45,['u']=46,['v']=47,
        ['w']=48,['x']=49,['y']=50,['z']=51,['0']=52,['1']=53,['2']=54,['3']=55,
        ['4']=56,['5']=57,['6']=58,['7']=59,['8']=60,['9']=61,['+']=62,['/']=63
    };

    int i, j, len = strlen(input);
    unsigned int val = 0;
    int valb = -8;
    for (i = 0, j = 0; i < len; i++) {
        unsigned char c = input[i];
        if (c == '=' || c > 127) break;
        if (dtable[c] == 0 && c != 'A') continue;
        val = (val << 6) | dtable[c];
        valb += 6;
        if (valb >= 0) {
            output[j++] = (val >> valb) & 0xFF;
            valb -= 8;
        }
    }
    return j;
}

